Лабораторные работы по дисциплине "Встраиваемые системы"

Отчёты доступны по ссылкам:


1.https://drive.google.com/file/d/1JD5WK-MjZKzYMy6n3danJXpAqu4SHcua/view?usp=sharing

# Лабораторная работа №1 - Знакомство с SPI
# Задача
Создать игру “Flappy Bird” с визуализацией на светодиодную панель 16x32 пикселя. Управление движение осуществляется через микрофон MAX9814. Реализация движения осуществляется следующим образом: чем выше амплитуда звука, тем выше летит “птица”.
# SPI - Serial Peripheral Interface
SPI
SPI (Serial Peripheral Interface) — последовательный синхронный стандарт передачи данных в режиме полного дуплекса, предназначенный для обеспечения простого и высокоскоростного сопряжения микроконтроллеров и периферии. SPI является синхронным интерфейсом, в котором любая передача синхронизирована с общим тактовым сигналом, генерируемым ведущим устройством (процессором). 
Уникальным преимуществом SPI является то, что данные могут передаваться без прерывания. Любое количество битов может быть отправлено или получено в непрерывном потоке. То есть, передаваемые пакеты не ограничены определенным количеством битов. Устройства, взаимодействующие через SPI, находятся в отношениях "ведущий-ведомый" или же Master-Slave, при этом в SPI предусмотрена возможность подключения к одному Master сразу нескольких Slave-устройств.

 ![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/dc2c869b-e59a-4ef3-b26f-53de28303eaa)
 
Схема передачи данных по SPI

Опишем линии связи, указанные на рисунке 1:
- MOSI (Master Output/Slave Input) – Линия для передачи данных от ведущего ведомому.
- MISO (Master Input/Slave Output) – Линия, по которой ведомый отправляет данные ведущему.
- SCLK (Clock) – Линия тактового сигнала.
- SS/CS (Slave Select/Chip Select) – линия для выбора ведомого устройства, которому будут отправляться данные.

В ситуациях, когда используется несколько ведомых устройств, существует два вида подключения, параллельно и последовательно, показаны на рисунках ниже.

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/77f3d537-8404-42c6-aa72-9669ae42600d)

Параллельная передача данных между ведущим и ведомыми устройствами

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/4646b1a5-c76c-42f0-8956-3a52a2054322)

Последовательная передача данных между ведущим и ведомыми устройствами

# Cветодиодная панель P10 Led Display Board
P10 Светодиодная панель или P10 Led Board представляет собой панель, состоящую из корпуса, светодиодов и управляющих микросхем. Размерность светодиодной панели в пикселях равна 16 по высоте и 32 по ширине. Управление светодиодной панелью осуществляется через интерфейс SPI, что позволяет подключать несколько панелей последовательно и масштабировать размерность панели. 

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/d41636e1-d95f-485c-b0d3-6320698e8eff)

На разъёме:
— Пины 6, 14, 16 (C, G, D) — не используются (возможно они используются в 3-цветных матрицах).
— Пины 2 и 4 (A и B) — задают, какая из 4 групп светодиодов экрана работает в данный момент. Матрицы используют динамическую индикацию, поочерёдно переключая 4 группы светодиодов в зависимости от логических уровней на ножках A и B. На плате эти сигналы приходят на дешифратор D18, который открывает 1 из 4 групп P-канальных полевиков, тем самым подавая +5В на аноды светодиодов выбранной группы.
— Пин 1 (nOE) — разрешает работу матрицы (лог. 0 гасит все матрицы в цепочке). Логика работы этого пина реализована на элементах НЕ в D19 и дешифраторе D18.
— Пины 8 и 12 (CLK и R) — линии клока и данных синхронного последовательного интерфейса. Их подключаем к SCK и MOSI интерфейса SPI микроконтроллера.
— Пин 10 (SCLK) — по переднему фронту защёлкивает переданные в сдвиговые регистры данные на их выходы. Сдвиговые регистры подключены к катодам светодиодов матрицы. По этой причине передаваемые данные нужно инвертировать (светодиод будет гореть при лог. 0).

# Ход выполнения работы
В начале работы был создан проект в среде STM32CubeMX. В ходе работы был инициализирован аналогово-цифровой преобразователь (АЦП) на пин PB0, а также таймер для считывания сигнала с микрофона с определенной частотой. Также для осуществления передачи данных с микроконтроллера на светодиодную панель используется интерфейс SPI, а именно цифровые сигналы MOSI ( отправка данных с микроконтроллера на светодиодную панель) и SCK (последовательный тактовый сигнал, для синхронизации работы).

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/4793ad16-cb25-4e81-a460-451f42d38d83)

Конфигурация портов MCU

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/9fcca99d-fcc7-421f-bf47-f8075296ca4a)

Настройка SPI интерфейса

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/3cf03256-97b8-4648-a23c-1e8c9efa3b7a)

Задействованные порты ввода/вывода

# Результат работы

![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/2a0cf28f-6a69-46c8-83d8-cafe7b8adc28)
![image](https://github.com/Kirsantiy/Embedded_systems_LABS/assets/133642673/a2e9e5ae-ec00-46f7-b403-04bbaffb8263)

Результат работы: https://drive.google.com/file/d/1ZdtxyG0yGU8SX9UHPGG57M0PBg6-hsJa/view?usp=sharing


